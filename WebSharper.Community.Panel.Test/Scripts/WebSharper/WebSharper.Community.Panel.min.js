(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;a=window;b=a.WebSharper=a.WebSharper||{};c=b.Community=b.Community||{};d=c.Panel=c.Panel||{};e=d.Panel=d.Panel||{};f=d.Rect=d.Rect||{};g=d.PanelItem=d.PanelItem||{};h=d.PanelContainer=d.PanelContainer||{};i=a.IntelliFactory;j=i&&i.Runtime;k=b&&b.Seq;l=b&&b.List;m=b&&b.UI;n=m&&m.Next;o=n&&n.AttrModule;p=n&&n.Var;q=b&&b.Unchecked;r=b&&b.Operators;s=n&&n.View;t=n&&n.Doc;u=n&&n.Key;v=n&&n.ListModel;e=d.Panel=j.Class({panelAttr:function(w,x,y,z){var A,B,C,D,E,F,G,H,I;A=this;B=k.concat([x,l.ofArray([o.Style("cursor","grab"),o.Handler("mouseenter",function(){return function(){var J;J=A.mouseOverVar;return p.Set(J,true);};}),o.Handler("mouseleave",function(){return function(){var J;J=A.mouseOverVar;return p.Set(J,false);};}),o.Handler("mouseup",function(){return function(){var J;J=A.mouseDownVar;return p.Set(J,false);};}),o.Handler("mousedown",function(){return function(J){var K,L,M,N,O;K=A.mouseDownVar;p.Set(K,true);L=A.leftOffset;M=+J.clientX-A.lastLeft.c;p.Set(L,M);N=A.topOffset;O=+J.clientY-A.lastTop.c;return p.Set(N,O);};}),o.Handler("mousemove",function(){return function(J){var K,L,M,N,O,P,Q,R,S,T;return(((A.mouseDownVar.c?A.mouseOverVar.c:false)?!q.Equals(A.element.c.parentElement,null):false)?!q.Equals(A.element.c.parentElement.parentElement,null):false)?(K=J.clientX,(L=J.clientY,(M=A.element.c.getBoundingClientRect(),(N=A.element.c.parentElement.getBoundingClientRect(),(O=N.width-M.width,(P=N.height-M.height,(Q=r.Min(O,r.Max(0,+K-A.leftOffset.c)),(R=r.Min(P,r.Max(0,+L-A.topOffset.c)),(S=A.lastLeft,p.Set(S,Q),T=A.lastTop,p.Set(T,R),A.arrangePanels(A)))))))))):null;};})])]);C=k.concat([w,l.ofArray([o.Style("position","absolute"),o.DynamicStyle("left",(D=this.lastLeft.v,s.Map(function(J){var K;a.console.log("x from lastLeft");K=function(L,M){return L(M.toFixed(6)+"px");};return(function(L){return function(M){return K(L,M);};}(a.id))(J);},D))),o.DynamicStyle("top",(E=this.lastTop.v,s.Map(function(J){var K;K=function(L,M){return L(M.toFixed(6)+"px");};return(function(L){return function(M){return K(L,M);};}(a.id))(J);},E)))])]);F=(G=[t.Element("div",B,y),z],t.Element("div",C,G));H=this.element;I=F.elt;p.Set(H,I);return F;}},null,e);e.Create=function(w){return e.New(p.Create$1(false),p.Create$1(false),p.Create$1(0),p.Create$1(0),p.Create$1(0),p.Create$1(0),p.Create$1(t.Element("div",[],[]).elt),w);};e.New=function(w,x,y,z,A,B,C,D){return new e({mouseOverVar:w,mouseDownVar:x,leftOffset:y,topOffset:z,lastLeft:A,lastTop:B,element:C,arrangePanels:D});};f=d.Rect=j.Class({toString:function(){return"left:"+a.String(this.left)+" "+" top:"+a.String(this.top)+" right:"+a.String(this.right)+" bottom:"+a.String(this.bottom);},inflate:function(w,x){var y,z;y=this.left-w;z=this.top-x;return f.New(y,this.right+w,z,this.bottom+x);},get_height:function(){return this.bottom-this.top;},get_width:function(){return this.right-this.left;},intersect:function(w){var x,y,z,A;x=r.Max(this.left,w.left);y=r.Min(this.right,w.right);z=r.Max(this.top,w.top);A=r.Min(this.bottom,w.bottom);return f.New(x,r.Max(x,y),z,r.Max(z,A));},offset:function(w,x){var y,z;y=this.left+w;z=this.top+x;return f.New(y,this.right+w,z,this.bottom+x);},get_isEmpty:function(){return this.left>=this.right?true:this.top>=this.bottom;}},null,f);f.fromPanel=function(w){return f.fromDomRect(w.element.c).offset(w.lastLeft.c,w.lastTop.c);};f.fromDomRect=function(w){var x;x=w.getBoundingClientRect();return f.New(0,x.width,0,x.height);};f.New=function(w,x,y,z){return new f({left:w,right:x,top:y,bottom:z});};g.Create=function(w,x){return g.New(u.Fresh(),w,e.Create(x));};g.New=function(w,x,y){return{Key:w,Name:x,Panel:y};};h=d.PanelContainer=j.Class({RenderPanelItem:function(w){var x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M;x=this;y=(z=w.Panel,(A=l.ofArray([o.Style("Width","150px")]),(B=l.ofArray([o.Class("panelTitle")]),(C=l.ofArray([(D=[o.Style("width","100%")],(E=[(F=[(G=[t.TextNode(w.Name)],t.Element("td",[],G)),(H=[o.Style("text-align","right"),o.Style("vertical-align","middle")],(I=[(J=[o.Class("material-icons orange600 small"),o.Style("cursor","pointer"),o.Handler("mousedown",function(){return function(){return x.PanelItems.Remove(w);};})],(K=[t.TextNode("clear")],t.Element("i",J,K)))],t.Element("td",H,I)))],t.Element("tr",[],F))],t.Element("table",D,E)))]),z.panelAttr(A,B,C,(L=[o.Class("panelContent")],(M=[t.TextNode("Content")],t.Element("div",L,M))))))));return y.OnAfterRender(function(){x.MovePanelToFreeSpace(w);});},CreateItem:function(w){var x;x=this;this.PanelItems.Append(g.Create(w,function(y){x.ArrangePanels(y);}));},MovePanelToFreeSpace:function(w){var x,y,z,A,B,C,D,E,F;x=f.fromPanel(w.Panel);y=f.fromDomRect(w.Panel.element.c.parentElement);z=(A=function(G){a.console.log("Finds free rect: "+a.String(G));return G.get_width()>=x.get_width()?G.get_height()>=x.get_height():false;},function(G){return k.tryFind(A,G);}(this.CollectFreeSpace(y,w)));(z!=null?z.$==1:false)?(B=z.$0,C=w.Panel.lastLeft,D=B.left+5,p.Set(C,D),E=w.Panel.lastTop,F=B.top+5,p.Set(E,F)):void 0;},ArrangePanels:function(w){var x,y,z,A,B;x=l.ofSeq(this.PanelItems);y=(z=function(C){return C.Panel.lastLeft.c===w.lastLeft.c?C.Panel.lastTop.c===w.lastTop.c:false;},function(C){return k.find(z,C);}(x));A=(B=function(C){return!q.Equals(C.Key,y.Key)?!f.fromPanel(C.Panel).intersect(f.fromPanel(y.Panel)).get_isEmpty():false;},function(C){return k.tryFind(B,C);}(l.ofSeq(this.PanelItems)));(A!=null?A.$==1:false)?this.MovePanelToFreeSpace(A.$0):void 0;},CollectFreeSpace:function(w,x){var y,z,A;y=(z=function(B){return!q.Equals(B.Key,x.Key);},function(B){return l.filter(z,B);}(l.ofSeq(this.PanelItems)));A=l.ofArray([w]);return k.fold(function(B,C){var D,E,F,G,H,I;D=f.fromDomRect(C.Panel.element.c).offset(C.Panel.lastLeft.c,C.Panel.lastTop.c).inflate(5,5);a.console.log("collectFreeSpace: "+a.String(D));E=f.New(0,w.right,0,D.top);F=f.New(0,D.left,D.top,D.bottom);return l.concat((G=function(J){var K,L;K=function(M){a.console.log("filter: "+a.String(M));return!M.get_isEmpty();};return function(M){return l.filter(K,M);}((L=function(M){return M.intersect(J);},function(M){return l.map(L,M);}(B)));},function(J){return l.map(G,J);}(l.ofArray([E,F,f.New(D.right,w.right,F.top,F.bottom),(H=D.bottom,(I=w.bottom,f.New(E.left,E.right,H,I)))]))));},A,y);}},null,h);h.get_Create=function(){var w;return h.New((w=new l.T({$:0}),v.Create(function(x){return x.Key;},w)));};h.New=function(w){return new h({PanelItems:w});};}());
