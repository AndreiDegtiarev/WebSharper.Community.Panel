(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y;a=window;b=a.WebSharper=a.WebSharper||{};c=b.Community=b.Community||{};d=c.Panel=c.Panel||{};e=d.TitleButton=d.TitleButton||{};f=d.Panel=d.Panel||{};g=d.Rect=d.Rect||{};h=d.PanelItem=d.PanelItem||{};i=d.PanelContainer=d.PanelContainer||{};j=a.IntelliFactory;k=j&&j.Runtime;l=b&&b.UI;m=l&&l.Next;n=m&&m.AttrModule;o=m&&m.Doc;p=m&&m.Var;q=m&&m.Input;r=q&&q.Mouse;s=m&&m.View;t=b&&b.Operators;u=b&&b.Seq;v=b&&b.List;w=b&&b.Unchecked;x=m&&m.Key;y=m&&m.ListModel;e=d.TitleButton=k.Class({Render:function(z){var A,B,C;A=this;B=[n.Class("material-icons orange600 small"),n.Style("cursor","pointer"),n.Handler("mousedown",function(){return function(){return A.action(z);};})];C=[o.TextNode(this.icon)];return o.Element("i",B,C);}},null,e);e.New=function(z,A){return new e({icon:z,action:A});};f=d.Panel=k.Class({get_Render:function(){var z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1;z=this;A=p.Create$1(false);B=p.Create$1(false);C=p.Create$1(0);D=p.Create$1(0);E=(F=r.get_LeftPressed(),s.Map(function(_2){return _2?A.c:false;},F));G=(H=r.get_Position(),s.UpdateWhile([0,0],E,H));I=(J=function(_2,_3){var _4,_5,_6,_7,_8,_9,_,$,ba,bb;return A.c?(_4=z.element.c.getBoundingClientRect(),(_5=z.element.c.parentElement.getBoundingClientRect(),(_6=_5.width-_4.width,(_7=_5.height-_4.height,(_8=t.Min(_6,t.Max(0,+_2-C.c)),(_9=t.Min(_7,t.Max(0,+_3-D.c)),(_=z.left,p.Set(_,_8),$=z.top,p.Set($,_9),ba="Last left:"+(bb=z.left.c,a.String(bb)),a.console.log(ba),z.arrangePanels(z),[_8,_9]))))))):[z.left.c,z.top.c];},s.Map(function(_2){return J(_2[0],_2[1]);},G));K=u.concat([this.titleAttrs,v.ofArray([n.Style("cursor","grab"),n.Handler("mouseenter",function(){return function(){return p.Set(B,true);};}),n.Handler("mouseleave",function(){return function(){return!A.c?p.Set(B,false):null;};}),n.Handler("mouseup",function(){return function(){p.Set(B,false);return p.Set(A,false);};}),n.Handler("mousedown",function(){return function(_2){var _3,_4;((B.c?!w.Equals(z.element.c.parentElement,null):false)?!w.Equals(z.element.c.parentElement.parentElement,null):false)?p.Set(A,true):void 0;_3=+_2.clientX-z.left.c;p.Set(C,_3);_4=+_2.clientY-z.top.c;return p.Set(D,_4);};})])]);L=(M=[n.Style("width","100%")],(N=[(O=[(P=this.titleContent,o.Element("td",[],P)),(Q=[n.Style("text-align","right"),n.Style("vertical-align","middle")],(R=(S=function(_2){return _2.Render(z);},function(_2){return v.map(S,_2);}(this.titleButtons)),o.Element("td",Q,R)))],o.Element("tr",[],O))],o.Element("table",M,N)));T=u.concat([this.pannelAttrs,v.ofArray([n.Style("position","absolute"),n.DynamicStyle("left",(U=this.left.v,s.Map(function(_2){var _3;_3=function(_4,_5){return _4(_5.toFixed(6)+"px");};return(function(_4){return function(_5){return _3(_4,_5);};}(a.id))(_2);},U))),n.DynamicStyle("left",(V=function(_2){var _3;_3=function(_4,_5){return _4(_5.toFixed(6)+"px");};return(function(_4){return function(_5){return _3(_4,_5);};}(a.id))(_2);},s.Map(function(_2){return V(_2[0],_2[1]);},I))),n.DynamicStyle("top",(W=function(_2,_3){var _4;_4=function(_5,_6){return _5(_6.toFixed(6)+"px");};return(function(_5){return function(_6){return _4(_5,_6);};}(a.id))(_3);},s.Map(function(_2){return W(_2[0],_2[1]);},I))),n.DynamicStyle("top",(X=this.top.v,s.Map(function(_2){var _3;_3=function(_4,_5){return _4(_5.toFixed(6)+"px");};return(function(_4){return function(_5){return _3(_4,_5);};}(a.id))(_2);},X)))])]);Y=(Z=[o.Element("div",K,[L]),this.content],o.Element("div",T,Z));_0=this.element;_1=Y.elt;p.Set(_0,_1);return Y;}},null,f);f.Create=function(z,A,B,C,D,E){return f.New(p.Create$1(0),p.Create$1(0),p.Create$1(null),z,A,B,C,D,E);};f.New=function(z,A,B,C,D,E,F,G,H){return new f({left:z,top:A,element:B,arrangePanels:C,pannelAttrs:D,titleAttrs:E,titleContent:F,titleButtons:G,content:H});};g=d.Rect=k.Class({toString:function(){return"left:"+a.String(this.left)+" "+" top:"+a.String(this.top)+" right:"+a.String(this.right)+" bottom:"+a.String(this.bottom);},inflate:function(z,A){var B,C;B=this.left-z;C=this.top-A;return g.New(B,this.right+z,C,this.bottom+A);},get_height:function(){return this.bottom-this.top;},get_width:function(){return this.right-this.left;},intersect:function(z){var A,B,C,D;A=t.Max(this.left,z.left);B=t.Min(this.right,z.right);C=t.Max(this.top,z.top);D=t.Min(this.bottom,z.bottom);return g.New(A,t.Max(A,B),C,t.Max(C,D));},offset:function(z,A){var B,C;B=this.left+z;C=this.top+A;return g.New(B,this.right+z,C,this.bottom+A);},get_isEmpty:function(){return this.left>=this.right?true:this.top>=this.bottom;}},null,g);g.fromPanel=function(z){return g.fromDomRect(z.element.c).offset(z.left.c,z.top.c);};g.fromDomRect=function(z){var A;A=z.getBoundingClientRect();return g.New(0,A.width,0,A.height);};g.New=function(z,A,B,C){return new g({left:z,right:A,top:B,bottom:C});};h.Create=function(z,A,B,C,D,E,F){return h.New(x.Fresh(),z,f.Create(A,B,C,D,E,F));};h.New=function(z,A,B){return{Key:z,Name:A,Panel:B};};i=d.PanelContainer=k.Class({RenderPanelItem:function(z){var A,B;A=this;B=z.Panel.get_Render();return B.OnAfterRender(function(){A.MovePanelToFreeSpace(z);});},CreateItem:function(z,A,B,C,D,E){var F;F=this;this.PanelItems.Append(h.Create(z,function(G){F.ArrangePanels(G);},A,B,C,D,E));},MovePanelToFreeSpace:function(z){var A,B,C,D,E,F,G,H,I;A=g.fromPanel(z.Panel);B=g.fromDomRect(z.Panel.element.c.parentElement);C=(D=function(J){a.console.log("Finds free rect: "+a.String(J));return J.get_width()>=A.get_width()?J.get_height()>=A.get_height():false;},function(J){return u.tryFind(D,J);}(this.CollectFreeSpace(B,z)));(C!=null?C.$==1:false)?(E=C.$0,F=z.Panel.left,G=E.left+5,p.Set(F,G),H=z.Panel.top,I=E.top+5,p.Set(H,I)):void 0;},ArrangePanels:function(z){var A,B,C,D,E;A=v.ofSeq(this.PanelItems);B=(C=function(F){return F.Panel.left.c===z.left.c?F.Panel.top.c===z.top.c:false;},function(F){return u.find(C,F);}(A));D=(E=function(F){return!w.Equals(F.Key,B.Key)?!g.fromPanel(F.Panel).intersect(g.fromPanel(B.Panel)).get_isEmpty():false;},function(F){return u.tryFind(E,F);}(v.ofSeq(this.PanelItems)));(D!=null?D.$==1:false)?this.MovePanelToFreeSpace(D.$0):void 0;},CollectFreeSpace:function(z,A){var B,C,D;B=(C=function(E){return!w.Equals(E.Key,A.Key);},function(E){return v.filter(C,E);}(v.ofSeq(this.PanelItems)));D=v.ofArray([z]);return u.fold(function(E,F){var G,H,I,J,K,L;G=g.fromDomRect(F.Panel.element.c).offset(F.Panel.left.c,F.Panel.top.c).inflate(5,5);a.console.log("collectFreeSpace: "+a.String(G));H=g.New(0,z.right,0,G.top);I=g.New(0,G.left,G.top,G.bottom);return v.concat((J=function(M){var N,O;N=function(P){a.console.log("filter: "+a.String(P));return!P.get_isEmpty();};return function(P){return v.filter(N,P);}((O=function(P){return P.intersect(M);},function(P){return v.map(O,P);}(E)));},function(M){return v.map(J,M);}(v.ofArray([H,I,g.New(G.right,z.right,I.top,I.bottom),(K=G.bottom,(L=z.bottom,g.New(H.left,H.right,K,L)))]))));},D,B);},FindPanelItem:function(z){var A;A=function(B){return w.Equals(B.Panel.element,z.element);};return function(B){return u.find(A,B);}(v.ofSeq(this.PanelItems));}},null,i);i.get_Create=function(){var z;return i.New((z=new v.T({$:0}),y.Create(function(A){return A.Key;},z)));};i.New=function(z){return new i({PanelItems:z});};}());
