(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;a=window;b=a.WebSharper=a.WebSharper||{};c=b.Community=b.Community||{};d=c.Panel=c.Panel||{};e=d.TitleButton=d.TitleButton||{};f=d.Panel=d.Panel||{};g=d.Rect=d.Rect||{};h=d.PanelContainer=d.PanelContainer||{};i=a.IntelliFactory;j=i&&i.Runtime;k=b&&b.UI;l=k&&k.Next;m=l&&l.AttrModule;n=l&&l.Doc;o=l&&l.Var;p=l&&l.Input;q=p&&p.Mouse;r=l&&l.View;s=b&&b.Operators;t=b&&b.Seq;u=b&&b.List;v=b&&b.Unchecked;w=l&&l.Key;x=l&&l.ListModel;e=d.TitleButton=j.Class({Render:function(y){var z,A,B;z=this;A=[m.Class("material-icons orange600 small"),m.Style("cursor","pointer"),m.Handler("click",function(){return function(){return z.Action(y);};})];B=[n.TextNode(this.Icon)];return n.Element("i",A,B);}},null,e);e.New=function(y,z){return new e({Icon:y,Action:z});};f=d.Panel=j.Class({get_Render:function(){var y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0;y=this;z=o.Create$1(false);A=o.Create$1(false);B=o.Create$1(0);C=o.Create$1(0);D=(E=q.get_LeftPressed(),r.Map(function(_1){return _1?z.c:false;},E));F=(G=q.get_Position(),r.UpdateWhile([0,0],D,G));H=(I=function(_1,_2){var _3,_4,_5,_6,_7,_8,_9,_,$,ba;return z.c?(_3=y.Element.c.getBoundingClientRect(),(_4=y.Element.c.parentElement.getBoundingClientRect(),(_5=_4.width-_3.width,(_6=_4.height-_3.height,(_7=s.Min(_5,s.Max(0,+_1-B.c)),(_8=s.Min(_6,s.Max(0,+_2-C.c)),(_9=y.Left,o.Set(_9,_7),_=y.Top,o.Set(_,_8),$="Last left:"+(ba=y.Left.c,a.String(ba)),a.console.log($),y.ArrangePanels(y),[_7,_8]))))))):[y.Left.c,y.Top.c];},r.Map(function(_1){return I(_1[0],_1[1]);},F));J=t.concat([this.TitleAttrs,u.ofArray([m.Style("cursor","grab"),m.Handler("mouseenter",function(){return function(){return o.Set(A,true);};}),m.Handler("mouseleave",function(){return function(){return!z.c?o.Set(A,false):null;};}),m.Handler("mouseup",function(){return function(){o.Set(A,false);return o.Set(z,false);};}),m.Handler("mousedown",function(){return function(_1){var _2,_3;((A.c?!v.Equals(y.Element.c.parentElement,null):false)?!v.Equals(y.Element.c.parentElement.parentElement,null):false)?o.Set(z,true):void 0;_2=+_1.clientX-y.Left.c;o.Set(B,_2);_3=+_1.clientY-y.Top.c;return o.Set(C,_3);};})])]);K=(L=[m.Style("width","100%")],(M=[(N=[(O=[this.TitleContent],n.Element("td",[],O)),(P=[m.Style("text-align","right"),m.Style("vertical-align","middle")],(Q=(R=function(_1){return _1.Render(y);},function(_1){return u.map(R,_1);}(this.TitleButtons)),n.Element("td",P,Q)))],n.Element("tr",[],N))],n.Element("table",L,M)));S=t.concat([this.PannelAttrs,u.ofArray([m.Style("position","absolute"),m.DynamicStyle("left",(T=this.Left.v,r.Map(function(_1){var _2;_2=function(_3,_4){return _3(_4.toFixed(6)+"px");};return(function(_3){return function(_4){return _2(_3,_4);};}(a.id))(_1);},T))),m.DynamicStyle("left",(U=function(_1){var _2;_2=function(_3,_4){return _3(_4.toFixed(6)+"px");};return(function(_3){return function(_4){return _2(_3,_4);};}(a.id))(_1);},r.Map(function(_1){return U(_1[0],_1[1]);},H))),m.DynamicStyle("top",(V=function(_1,_2){var _3;_3=function(_4,_5){return _4(_5.toFixed(6)+"px");};return(function(_4){return function(_5){return _3(_4,_5);};}(a.id))(_2);},r.Map(function(_1){return V(_1[0],_1[1]);},H))),m.DynamicStyle("top",(W=this.Top.v,r.Map(function(_1){var _2;_2=function(_3,_4){return _3(_4.toFixed(6)+"px");};return(function(_3){return function(_4){return _2(_3,_4);};}(a.id))(_1);},W)))])]);X=(Y=[n.Element("div",J,[K]),this.PanelContent],n.Element("div",S,Y));Z=this.Element;_0=X.elt;o.Set(Z,_0);return X;},WithArrangePanelsFnc:function(y){return f.New(this.Key,this.Left,this.Top,this.Element,y,this.PannelAttrs,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent);},WithPanelContent:function(y){return f.New(this.Key,this.Left,this.Top,this.Element,this.ArrangePanels,this.PannelAttrs,this.TitleAttrs,this.TitleContent,this.TitleButtons,y);},WithTitleButtons:function(y){return f.New(this.Key,this.Left,this.Top,this.Element,this.ArrangePanels,this.PannelAttrs,this.TitleAttrs,this.TitleContent,y,this.PanelContent);},WithTitleContent:function(y){return f.New(this.Key,this.Left,this.Top,this.Element,this.ArrangePanels,this.PannelAttrs,this.TitleAttrs,y,this.TitleButtons,this.PanelContent);},WithTitleAttrs:function(y){return f.New(this.Key,this.Left,this.Top,this.Element,this.ArrangePanels,this.PannelAttrs,y,this.TitleContent,this.TitleButtons,this.PanelContent);},WithPannelAttrs:function(y){return f.New(this.Key,this.Left,this.Top,this.Element,this.ArrangePanels,y,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent);}},null,f);f.get_Create=function(){return f.New(w.Fresh(),o.Create$1(0),o.Create$1(0),o.Create$1(null),function(){},new u.T({$:0}),u.ofArray([m.Class("panelTitle")]),n.Element("div",[],[]),new u.T({$:0}),n.Element("div",[],[]));};f.New=function(y,z,A,B,C,D,E,F,G,H){return new f({Key:y,Left:z,Top:A,Element:B,ArrangePanels:C,PannelAttrs:D,TitleAttrs:E,TitleContent:F,TitleButtons:G,PanelContent:H});};g=d.Rect=j.Class({toString:function(){return"left:"+a.String(this.left)+" "+" top:"+a.String(this.top)+" right:"+a.String(this.right)+" bottom:"+a.String(this.bottom);},inflate:function(y,z){var A,B;A=this.left-y;B=this.top-z;return g.New(A,this.right+y,B,this.bottom+z);},get_height:function(){return this.bottom-this.top;},get_width:function(){return this.right-this.left;},intersect:function(y){var z,A,B,C;z=s.Max(this.left,y.left);A=s.Min(this.right,y.right);B=s.Max(this.top,y.top);C=s.Min(this.bottom,y.bottom);return g.New(z,s.Max(z,A),B,s.Max(B,C));},offset:function(y,z){var A,B;A=this.left+y;B=this.top+z;return g.New(A,this.right+y,B,this.bottom+z);},get_isEmpty:function(){return this.left>=this.right?true:this.top>=this.bottom;}},null,g);g.fromPanel=function(y){return g.fromDomRect(y.Element.c).offset(y.Left.c,y.Top.c);};g.fromDomRect=function(y){var z;z=y.getBoundingClientRect();return g.New(0,z.width,0,z.height);};g.New=function(y,z,A,B){return new g({left:y,right:z,top:A,bottom:B});};h=d.PanelContainer=j.Class({RenderPanelItem:function(y){var z,A;z=this;A=y.get_Render();return A.OnAfterRender(function(){z.MovePanelToFreeSpace(y);});},AddPanel:function(y){var z;z=this;this.PanelItems.Append(y.WithArrangePanelsFnc(function(A){z.ArrangePanels(A);}));},MovePanelToFreeSpace:function(y){var z,A,B,C,D,E,F,G,H;z=g.fromPanel(y);A=g.fromDomRect(y.Element.c.parentElement);B=(C=function(I){a.console.log("Finds free rect: "+a.String(I));return I.get_width()>=z.get_width()?I.get_height()>=z.get_height():false;},function(I){return t.tryFind(C,I);}(this.CollectFreeSpace(A,y)));(B!=null?B.$==1:false)?(D=B.$0,E=y.Left,F=D.left+5,o.Set(E,F),G=y.Top,H=D.top+5,o.Set(G,H)):void 0;},ArrangePanels:function(y){var z,A,B,C,D;z=u.ofSeq(this.PanelItems);A=(B=function(E){return E.Left.c===y.Left.c?E.Top.c===y.Top.c:false;},function(E){return t.find(B,E);}(z));C=(D=function(E){return!v.Equals(E.Key,A.Key)?!g.fromPanel(E).intersect(g.fromPanel(A)).get_isEmpty():false;},function(E){return t.tryFind(D,E);}(u.ofSeq(this.PanelItems)));(C!=null?C.$==1:false)?this.MovePanelToFreeSpace(C.$0):void 0;},CollectFreeSpace:function(y,z){var A,B,C;A=(B=function(D){return!v.Equals(D.Key,z.Key);},function(D){return u.filter(B,D);}(u.ofSeq(this.PanelItems)));C=u.ofArray([y]);return t.fold(function(D,E){var F,G,H,I,J,K;F=g.fromDomRect(E.Element.c).offset(E.Left.c,E.Top.c).inflate(5,5);a.console.log("collectFreeSpace: "+a.String(F));G=g.New(0,y.right,0,F.top);H=g.New(0,F.left,F.top,F.bottom);return u.concat((I=function(L){var M,N;M=function(O){a.console.log("filter: "+a.String(O));return!O.get_isEmpty();};return function(O){return u.filter(M,O);}((N=function(O){return O.intersect(L);},function(O){return u.map(N,O);}(D)));},function(L){return u.map(I,L);}(u.ofArray([G,H,g.New(F.right,y.right,H.top,H.bottom),(J=F.bottom,(K=y.bottom,g.New(G.left,G.right,J,K)))]))));},C,A);},FindPanelItem:function(y){var z;z=function(A){return v.Equals(A.Element,y.Element);};return function(A){return t.find(z,A);}(u.ofSeq(this.PanelItems));}},null,h);h.get_Create=function(){var y;return h.New((y=new u.T({$:0}),x.Create(function(z){return z.Key;},y)));};h.New=function(y){return new h({PanelItems:y});};}());
