(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;a=window;b=a.WebSharper=a.WebSharper||{};c=b.Community=b.Community||{};d=c.Panel=c.Panel||{};e=d.Panel=d.Panel||{};f=d.Rect=d.Rect||{};g=d.PanelItem=d.PanelItem||{};h=d.PanelContainer=d.PanelContainer||{};i=a.IntelliFactory;j=i&&i.Runtime;k=b&&b.UI;l=k&&k.Next;m=l&&l.Var;n=b&&b.Seq;o=b&&b.List;p=l&&l.AttrModule;q=b&&b.Unchecked;r=b&&b.Operators;s=l&&l.View;t=l&&l.Doc;u=l&&l.Key;v=l&&l.ListModel;e=d.Panel=j.Class({get_panelAttr:function(){var w,x,y,z,A,B,C,D,E,F,G,H,I,J;w=this;x=m.Create$1(false);y=m.Create$1(false);z=m.Create$1(0);A=m.Create$1(0);B=n.concat([this.titleAttrs,o.ofArray([p.Style("cursor","grab"),p.Handler("mouseenter",function(){return function(){return m.Set(y,true);};}),p.Handler("mouseleave",function(){return function(){return!x.c?m.Set(y,false):null;};}),p.Handler("mouseup",function(){return function(){m.Set(y,false);return m.Set(x,false);};}),p.Handler("mousedown",function(){return function(K){var L,M;y.c?m.Set(x,true):void 0;L=+K.clientX-w.left.c;m.Set(z,L);M=+K.clientY-w.top.c;return m.Set(A,M);};}),p.Handler("mousemove",function(){return function(K){var L,M,N,O,P,Q,R,S,T,U,V,W,X;L="on.mouseMove:"+(M=K.button,a.String(M))+" "+(N=K.clientX,a.String(N));a.console.log(L);return((x.c?!q.Equals(w.element.c.parentElement,null):false)?!q.Equals(w.element.c.parentElement.parentElement,null):false)?(O=K.clientX,(P=K.clientY,(Q=w.element.c.getBoundingClientRect(),(R=w.element.c.parentElement.getBoundingClientRect(),(S=R.width-Q.width,(T=R.height-Q.height,(U=r.Min(S,r.Max(0,+O-z.c)),(V=r.Min(T,r.Max(0,+P-A.c)),(W=w.left,m.Set(W,U),X=w.top,m.Set(X,V),w.arrangePanels(w)))))))))):null;};})])]);C=n.concat([this.pannelAttrs,o.ofArray([p.Style("position","absolute"),p.DynamicStyle("left",(D=this.left.v,s.Map(function(K){var L;L=function(M,N){return M(N.toFixed(6)+"px");};return(function(M){return function(N){return L(M,N);};}(a.id))(K);},D))),p.DynamicStyle("top",(E=this.top.v,s.Map(function(K){var L;L=function(M,N){return M(N.toFixed(6)+"px");};return(function(M){return function(N){return L(M,N);};}(a.id))(K);},E)))])]);F=(G=[(H=this.titleContent,t.Element("div",B,H)),this.content],t.Element("div",C,G));I=this.element;J=F.elt;m.Set(I,J);return F;}},null,e);e.Create=function(w,x,y,z,A){return e.New(m.Create$1(0),m.Create$1(0),m.Create$1(t.Element("div",[],[]).elt),w,x,y,z,A);};e.New=function(w,x,y,z,A,B,C,D){return new e({left:w,top:x,element:y,arrangePanels:z,pannelAttrs:A,titleAttrs:B,titleContent:C,content:D});};f=d.Rect=j.Class({toString:function(){return"left:"+a.String(this.left)+" "+" top:"+a.String(this.top)+" right:"+a.String(this.right)+" bottom:"+a.String(this.bottom);},inflate:function(w,x){var y,z;y=this.left-w;z=this.top-x;return f.New(y,this.right+w,z,this.bottom+x);},get_height:function(){return this.bottom-this.top;},get_width:function(){return this.right-this.left;},intersect:function(w){var x,y,z,A;x=r.Max(this.left,w.left);y=r.Min(this.right,w.right);z=r.Max(this.top,w.top);A=r.Min(this.bottom,w.bottom);return f.New(x,r.Max(x,y),z,r.Max(z,A));},offset:function(w,x){var y,z;y=this.left+w;z=this.top+x;return f.New(y,this.right+w,z,this.bottom+x);},get_isEmpty:function(){return this.left>=this.right?true:this.top>=this.bottom;}},null,f);f.fromPanel=function(w){return f.fromDomRect(w.element.c).offset(w.left.c,w.top.c);};f.fromDomRect=function(w){var x;x=w.getBoundingClientRect();return f.New(0,x.width,0,x.height);};f.New=function(w,x,y,z){return new f({left:w,right:x,top:y,bottom:z});};g.Create=function(w,x,y,z,A,B){return g.New(u.Fresh(),w,e.Create(x,y,z,A,B));};g.New=function(w,x,y){return{Key:w,Name:x,Panel:y};};h=d.PanelContainer=j.Class({RenderPanelItem:function(w){var x,y;x=this;y=w.Panel.get_panelAttr();return y.OnAfterRender(function(){x.MovePanelToFreeSpace(w);});},CreateItem:function(w,x,y,z,A){var B;B=this;this.PanelItems.Append(g.Create(w,function(C){B.ArrangePanels(C);},x,y,z,A));},MovePanelToFreeSpace:function(w){var x,y,z,A,B,C,D,E,F;x=f.fromPanel(w.Panel);y=f.fromDomRect(w.Panel.element.c.parentElement);z=(A=function(G){a.console.log("Finds free rect: "+a.String(G));return G.get_width()>=x.get_width()?G.get_height()>=x.get_height():false;},function(G){return n.tryFind(A,G);}(this.CollectFreeSpace(y,w)));(z!=null?z.$==1:false)?(B=z.$0,C=w.Panel.left,D=B.left+5,m.Set(C,D),E=w.Panel.top,F=B.top+5,m.Set(E,F)):void 0;},ArrangePanels:function(w){var x,y,z,A,B;x=o.ofSeq(this.PanelItems);y=(z=function(C){return C.Panel.left.c===w.left.c?C.Panel.top.c===w.top.c:false;},function(C){return n.find(z,C);}(x));A=(B=function(C){return!q.Equals(C.Key,y.Key)?!f.fromPanel(C.Panel).intersect(f.fromPanel(y.Panel)).get_isEmpty():false;},function(C){return n.tryFind(B,C);}(o.ofSeq(this.PanelItems)));(A!=null?A.$==1:false)?this.MovePanelToFreeSpace(A.$0):void 0;},CollectFreeSpace:function(w,x){var y,z,A;y=(z=function(B){return!q.Equals(B.Key,x.Key);},function(B){return o.filter(z,B);}(o.ofSeq(this.PanelItems)));A=o.ofArray([w]);return n.fold(function(B,C){var D,E,F,G,H,I;D=f.fromDomRect(C.Panel.element.c).offset(C.Panel.left.c,C.Panel.top.c).inflate(5,5);a.console.log("collectFreeSpace: "+a.String(D));E=f.New(0,w.right,0,D.top);F=f.New(0,D.left,D.top,D.bottom);return o.concat((G=function(J){var K,L;K=function(M){a.console.log("filter: "+a.String(M));return!M.get_isEmpty();};return function(M){return o.filter(K,M);}((L=function(M){return M.intersect(J);},function(M){return o.map(L,M);}(B)));},function(J){return o.map(G,J);}(o.ofArray([E,F,f.New(D.right,w.right,F.top,F.bottom),(H=D.bottom,(I=w.bottom,f.New(E.left,E.right,H,I)))]))));},A,y);},FindPanelItemFromChildElement:function(w){var x;x=function(y){while(true)if(q.Equals(w,y.Panel.element.c))return true;else if(q.Equals(w,null))return false;else w=w.parentElement;};return function(y){return n.tryFind(x,y);}(o.ofSeq(this.PanelItems));}},null,h);h.get_Create=function(){var w;return h.New((w=new o.T({$:0}),v.Create(function(x){return x.Key;},w)));};h.New=function(w){return new h({PanelItems:w});};}());
