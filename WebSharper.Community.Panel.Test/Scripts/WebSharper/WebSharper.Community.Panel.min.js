(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;a=window;b=a.WebSharper=a.WebSharper||{};c=b.Community=b.Community||{};d=c.Panel=c.Panel||{};e=d.Panel=d.Panel||{};f=d.Rect=d.Rect||{};g=d.PanelItem=d.PanelItem||{};h=d.PanelContainer=d.PanelContainer||{};i=a.IntelliFactory;j=i&&i.Runtime;k=b&&b.UI;l=k&&k.Next;m=l&&l.Var;n=l&&l.Input;o=n&&n.Mouse;p=l&&l.View;q=b&&b.Operators;r=b&&b.Seq;s=b&&b.List;t=l&&l.AttrModule;u=b&&b.Unchecked;v=l&&l.Doc;w=l&&l.Key;x=l&&l.ListModel;e=d.Panel=j.Class({get_panelAttr:function(){var y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T;y=this;z=m.Create$1(false);A=m.Create$1(false);B=m.Create$1(0);C=m.Create$1(0);D=(E=o.get_LeftPressed(),p.Map(function(U){return U?z.c:false;},E));F=(G=o.get_Position(),p.UpdateWhile([0,0],D,G));H=(I=function(U,V){var W,X,Y,Z,_0,_1,_2,_3,_4,_5;return z.c?(W=y.element.c.getBoundingClientRect(),(X=y.element.c.parentElement.getBoundingClientRect(),(Y=X.width-W.width,(Z=X.height-W.height,(_0=q.Min(Y,q.Max(0,+U-B.c)),(_1=q.Min(Z,q.Max(0,+V-C.c)),(_2=y.left,m.Set(_2,_0),_3=y.top,m.Set(_3,_1),_4="Last left:"+(_5=y.left.c,a.String(_5)),a.console.log(_4),y.arrangePanels(y),[_0,_1]))))))):[y.left.c,y.top.c];},p.Map(function(U){return I(U[0],U[1]);},F));J=r.concat([this.titleAttrs,s.ofArray([t.Style("cursor","grab"),t.Handler("mouseenter",function(){return function(){return m.Set(A,true);};}),t.Handler("mouseleave",function(){return function(){return!z.c?m.Set(A,false):null;};}),t.Handler("mouseup",function(){return function(){m.Set(A,false);return m.Set(z,false);};}),t.Handler("mousedown",function(){return function(U){var V,W;((A.c?!u.Equals(y.element.c.parentElement,null):false)?!u.Equals(y.element.c.parentElement.parentElement,null):false)?m.Set(z,true):void 0;V=+U.clientX-y.left.c;m.Set(B,V);W=+U.clientY-y.top.c;return m.Set(C,W);};})])]);K=r.concat([this.pannelAttrs,s.ofArray([t.Style("position","absolute"),t.DynamicStyle("left",(L=this.left.v,p.Map(function(U){var V;V=function(W,X){return W(X.toFixed(6)+"px");};return(function(W){return function(X){return V(W,X);};}(a.id))(U);},L))),t.DynamicStyle("left",(M=function(U){var V;V=function(W,X){return W(X.toFixed(6)+"px");};return(function(W){return function(X){return V(W,X);};}(a.id))(U);},p.Map(function(U){return M(U[0],U[1]);},H))),t.DynamicStyle("top",(N=function(U,V){var W;W=function(X,Y){return X(Y.toFixed(6)+"px");};return(function(X){return function(Y){return W(X,Y);};}(a.id))(V);},p.Map(function(U){return N(U[0],U[1]);},H))),t.DynamicStyle("top",(O=this.top.v,p.Map(function(U){var V;V=function(W,X){return W(X.toFixed(6)+"px");};return(function(W){return function(X){return V(W,X);};}(a.id))(U);},O)))])]);P=(Q=[(R=this.titleContent,v.Element("div",J,R)),this.content],v.Element("div",K,Q));S=this.element;T=P.elt;m.Set(S,T);return P;}},null,e);e.Create=function(y,z,A,B,C){return e.New(m.Create$1(0),m.Create$1(0),m.Create$1(null),y,z,A,B,C);};e.New=function(y,z,A,B,C,D,E,F){return new e({left:y,top:z,element:A,arrangePanels:B,pannelAttrs:C,titleAttrs:D,titleContent:E,content:F});};f=d.Rect=j.Class({toString:function(){return"left:"+a.String(this.left)+" "+" top:"+a.String(this.top)+" right:"+a.String(this.right)+" bottom:"+a.String(this.bottom);},inflate:function(y,z){var A,B;A=this.left-y;B=this.top-z;return f.New(A,this.right+y,B,this.bottom+z);},get_height:function(){return this.bottom-this.top;},get_width:function(){return this.right-this.left;},intersect:function(y){var z,A,B,C;z=q.Max(this.left,y.left);A=q.Min(this.right,y.right);B=q.Max(this.top,y.top);C=q.Min(this.bottom,y.bottom);return f.New(z,q.Max(z,A),B,q.Max(B,C));},offset:function(y,z){var A,B;A=this.left+y;B=this.top+z;return f.New(A,this.right+y,B,this.bottom+z);},get_isEmpty:function(){return this.left>=this.right?true:this.top>=this.bottom;}},null,f);f.fromPanel=function(y){return f.fromDomRect(y.element.c).offset(y.left.c,y.top.c);};f.fromDomRect=function(y){var z;z=y.getBoundingClientRect();return f.New(0,z.width,0,z.height);};f.New=function(y,z,A,B){return new f({left:y,right:z,top:A,bottom:B});};g.Create=function(y,z,A,B,C,D){return g.New(w.Fresh(),y,e.Create(z,A,B,C,D));};g.New=function(y,z,A){return{Key:y,Name:z,Panel:A};};h=d.PanelContainer=j.Class({RenderPanelItem:function(y){var z,A;z=this;A=y.Panel.get_panelAttr();return A.OnAfterRender(function(){z.MovePanelToFreeSpace(y);});},CreateItem:function(y,z,A,B,C){var D;D=this;this.PanelItems.Append(g.Create(y,function(E){D.ArrangePanels(E);},z,A,B,C));},MovePanelToFreeSpace:function(y){var z,A,B,C,D,E,F,G,H;z=f.fromPanel(y.Panel);A=f.fromDomRect(y.Panel.element.c.parentElement);B=(C=function(I){a.console.log("Finds free rect: "+a.String(I));return I.get_width()>=z.get_width()?I.get_height()>=z.get_height():false;},function(I){return r.tryFind(C,I);}(this.CollectFreeSpace(A,y)));(B!=null?B.$==1:false)?(D=B.$0,E=y.Panel.left,F=D.left+5,m.Set(E,F),G=y.Panel.top,H=D.top+5,m.Set(G,H)):void 0;},ArrangePanels:function(y){var z,A,B,C,D;z=s.ofSeq(this.PanelItems);A=(B=function(E){return E.Panel.left.c===y.left.c?E.Panel.top.c===y.top.c:false;},function(E){return r.find(B,E);}(z));C=(D=function(E){return!u.Equals(E.Key,A.Key)?!f.fromPanel(E.Panel).intersect(f.fromPanel(A.Panel)).get_isEmpty():false;},function(E){return r.tryFind(D,E);}(s.ofSeq(this.PanelItems)));(C!=null?C.$==1:false)?this.MovePanelToFreeSpace(C.$0):void 0;},CollectFreeSpace:function(y,z){var A,B,C;A=(B=function(D){return!u.Equals(D.Key,z.Key);},function(D){return s.filter(B,D);}(s.ofSeq(this.PanelItems)));C=s.ofArray([y]);return r.fold(function(D,E){var F,G,H,I,J,K;F=f.fromDomRect(E.Panel.element.c).offset(E.Panel.left.c,E.Panel.top.c).inflate(5,5);a.console.log("collectFreeSpace: "+a.String(F));G=f.New(0,y.right,0,F.top);H=f.New(0,F.left,F.top,F.bottom);return s.concat((I=function(L){var M,N;M=function(O){a.console.log("filter: "+a.String(O));return!O.get_isEmpty();};return function(O){return s.filter(M,O);}((N=function(O){return O.intersect(L);},function(O){return s.map(N,O);}(D)));},function(L){return s.map(I,L);}(s.ofArray([G,H,f.New(F.right,y.right,H.top,H.bottom),(J=F.bottom,(K=y.bottom,f.New(G.left,G.right,J,K)))]))));},C,A);},FindPanelItemFromChildElement:function(y){var z;z=function(A){while(true)if(u.Equals(y,A.Panel.element.c))return true;else if(u.Equals(y,null))return false;else y=y.parentElement;};return function(A){return r.tryFind(z,A);}(s.ofSeq(this.PanelItems));}},null,h);h.get_Create=function(){var y;return h.New((y=new s.T({$:0}),x.Create(function(z){return z.Key;},y)));};h.New=function(y){return new h({PanelItems:y});};}());
