(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;a=window;b=a.WebSharper=a.WebSharper||{};c=b.Community=b.Community||{};d=c.Panel=c.Panel||{};e=d.Panel=d.Panel||{};f=d.Rect=d.Rect||{};g=d.PanelItem=d.PanelItem||{};h=d.PanelContainer=d.PanelContainer||{};i=a.IntelliFactory;j=i&&i.Runtime;k=b&&b.Seq;l=b&&b.List;m=b&&b.UI;n=m&&m.Next;o=n&&n.AttrModule;p=n&&n.Var;q=b&&b.Unchecked;r=b&&b.Operators;s=n&&n.View;t=n&&n.Doc;u=n&&n.Key;v=n&&n.ListModel;e=d.Panel=j.Class({panelAttr:function(w,x,y,z){var A,B,C,D,E,F,G,H,I;A=this;B=k.concat([x,l.ofArray([o.Style("cursor","grab"),o.Handler("mouseenter",function(){return function(){var J;J=A.mouseOverVar;return p.Set(J,true);};}),o.Handler("mouseleave",function(){return function(){var J;J=A.mouseOverVar;return p.Set(J,false);};}),o.Handler("mouseup",function(){return function(){var J;J=A.mouseDownVar;return p.Set(J,false);};}),o.Handler("mousedown",function(){return function(J){var K,L,M,N,O;K=A.mouseDownVar;p.Set(K,true);L=A.leftOffset;M=+J.clientX-A.lastLeft.c;p.Set(L,M);N=A.topOffset;O=+J.clientY-A.lastTop.c;return p.Set(N,O);};}),o.Handler("mousemove",function(){return function(J){var K,L,M,N,O,P,Q,R,S,T;return(((A.mouseDownVar.c?A.mouseOverVar.c:false)?!q.Equals(A.element.c.parentElement,null):false)?!q.Equals(A.element.c.parentElement.parentElement,null):false)?(K=J.clientX,(L=J.clientY,(M=A.element.c.getBoundingClientRect(),(N=A.element.c.parentElement.getBoundingClientRect(),(O=N.width-M.width,(P=N.height-M.height,(Q=r.Min(O,r.Max(0,+K-A.leftOffset.c)),(R=r.Min(P,r.Max(0,+L-A.topOffset.c)),(S=A.lastLeft,p.Set(S,Q),T=A.lastTop,p.Set(T,R)))))))))):null;};})])]);C=k.concat([w,l.ofArray([o.Style("position","absolute"),o.DynamicStyle("left",(D=this.lastLeft.v,s.Map(function(J){var K;a.console.log("x from lastLeft");K=function(L,M){return L(M.toFixed(6)+"px");};return(function(L){return function(M){return K(L,M);};}(a.id))(J);},D))),o.DynamicStyle("top",(E=this.lastTop.v,s.Map(function(J){var K;K=function(L,M){return L(M.toFixed(6)+"px");};return(function(L){return function(M){return K(L,M);};}(a.id))(J);},E)))])]);F=(G=[t.Element("div",B,y),z],t.Element("div",C,G));H=this.element;I=F.elt;p.Set(H,I);return F;}},null,e);e.get_Create=function(){return e.New(p.Create$1(false),p.Create$1(false),p.Create$1(0),p.Create$1(0),p.Create$1(0),p.Create$1(0),p.Create$1(t.Element("div",[],[]).elt));};e.New=function(w,x,y,z,A,B,C){return new e({mouseOverVar:w,mouseDownVar:x,leftOffset:y,topOffset:z,lastLeft:A,lastTop:B,element:C});};f=d.Rect=j.Class({toString:function(){return"left:"+a.String(this.left)+" "+" top:"+a.String(this.top)+" right:"+a.String(this.right)+" bottom:"+a.String(this.bottom);},inflate:function(w,x){var y,z;y=this.left-w;z=this.top-x;return f.New(y,this.right+w,z,this.bottom+x);},get_height:function(){return this.bottom-this.top;},get_width:function(){return this.right-this.left;},intersect:function(w){var x,y,z,A;x=r.Max(this.left,w.left);y=r.Min(this.right,w.right);z=r.Max(this.top,w.top);A=r.Min(this.bottom,w.bottom);return f.New(x,r.Max(x,y),z,r.Max(z,A));},offset:function(w,x){var y,z;y=this.left+w;z=this.top+x;return f.New(y,this.right+w,z,this.bottom+x);},get_isEmpty:function(){return this.left>=this.right?true:this.top>=this.bottom;}},null,f);f.fromDomRect=function(w){var x;x=w.getBoundingClientRect();return f.New(0,x.width,0,x.height);};f.New=function(w,x,y,z){return new f({left:w,right:x,top:y,bottom:z});};g.Create=function(w){return g.New(u.Fresh(),w,e.get_Create());};g.New=function(w,x,y){return{Key:w,Name:x,Panel:y};};h=d.PanelContainer=j.Class({RenderPanelItem:function(w){var x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N;x=this;y=function(O,P){var Q,R,S;Q=(R=function(T){return!q.Equals(T.Key,P.Key);},function(T){return l.filter(R,T);}(l.ofSeq(x.PanelItems)));S=l.ofArray([O]);return k.fold(function(T,U){var V,W,X,Y,Z,_0;V=f.fromDomRect(U.Panel.element.c).offset(U.Panel.lastLeft.c,U.Panel.lastTop.c).inflate(5,5);a.console.log("collectFreeSpace: "+a.String(V));W=f.New(0,O.right,0,V.top);X=f.New(0,V.left,V.top,V.bottom);return l.concat((Y=function(_1){var _2,_3;_2=function(_4){a.console.log("filter: "+a.String(_4));return!_4.get_isEmpty();};return function(_4){return l.filter(_2,_4);}((_3=function(_4){return _4.intersect(_1);},function(_4){return l.map(_3,_4);}(T)));},function(_1){return l.map(Y,_1);}(l.ofArray([W,X,f.New(V.right,O.right,X.top,X.bottom),(Z=V.bottom,(_0=O.bottom,f.New(W.left,W.right,Z,_0)))]))));},S,Q);};z=(A=w.Panel,(B=l.ofArray([o.Style("Width","150px")]),(C=l.ofArray([o.Class("panelTitle")]),(D=l.ofArray([(E=[o.Style("width","100%")],(F=[(G=[(H=[t.TextNode(w.Name)],t.Element("td",[],H)),(I=[o.Style("text-align","right"),o.Style("vertical-align","middle")],(J=[(K=[o.Class("material-icons orange600 small"),o.Style("cursor","pointer"),o.Handler("mousedown",function(){return function(){return x.PanelItems.Remove(w);};})],(L=[t.TextNode("clear")],t.Element("i",K,L)))],t.Element("td",I,J)))],t.Element("tr",[],G))],t.Element("table",E,F)))]),A.panelAttr(B,C,D,(M=[o.Class("panelContent")],(N=[t.TextNode("Content")],t.Element("div",M,N))))))));return z.OnAfterRender(function(O){var P,Q,R,S,T,U,V,W,X;P=f.fromDomRect(O);Q=f.fromDomRect(O.parentElement);a.console.log("Add panel: "+a.String(P)+" "+a.String(Q));R=(S=function(Y){a.console.log("Finds free rect: "+a.String(Y));return Y.get_width()>=P.get_width()?Y.get_height()>=P.get_height():false;},function(Y){return k.tryFind(S,Y);}(y(Q,w)));(R!=null?R.$==1:false)?(T=R.$0,U=w.Panel.lastLeft,V=T.left+5,p.Set(U,V),W=w.Panel.lastTop,X=T.top+5,p.Set(W,X)):void 0;});},CreateItem:function(w){this.PanelItems.Append(g.Create(w));}},null,h);h.get_Create=function(){var w;return h.New((w=new l.T({$:0}),v.Create(function(x){return x.Key;},w)));};h.New=function(w){return new h({PanelItems:w});};}());
